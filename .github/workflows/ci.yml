name: CI

on: [push]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      max-parallel: 4
      matrix:
        python-version:
          - "3.9"
          - "3.10"
          - "3.11"
          - "3.12"
          - "3.13"

    steps:
    - uses: actions/checkout@v5

    - name: Install the latest version of uv
      uses: astral-sh/setup-uv@v6

    - name: Run tests
      run: |
        uv run --python ${{ matrix.python-version }} pytest --cov-report=xml --cov=kong --log-level DEBUG

  lint:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v5

    - name: Install the latest version of uv
      uses: astral-sh/setup-uv@v6

    - name: Run linters
      run: uvx --python 3.8 pre-commit run --all-files


  # publish:
  #   runs-on: ubuntu-latest
  #   if: github.event_name == 'push' && github.ref == 'refs/heads/master'
  #   needs:
  #     - test
  #     - lint
  #   steps:
  #     - uses: actions/checkout@v5
  #       with:
  #         fetch-depth: 0
  #     - name: Python Semantic Release
  #       uses: relekang/python-semantic-release@v7.2.1
  #       with:
  #         github_token: ${{ secrets.GH_TOKEN }}
  #         pypi_token: ${{ secrets.PYPI_TOKEN }}
